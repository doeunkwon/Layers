CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE SCHEMA backend_schema;
CREATE TABLE backend_schema.user (
    uid UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(50) NOT NULL,
    private BOOL NOT NULL,
    followers UUID[],
    following UUID[],
    profile_picture BYTEA
);
CREATE TABLE backend_schema.outfit (
    oid UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    title VARCHAR(50) NOT NULL, 
    // Need to limit clothing_items to only refer to ciid UUIDs
    clothing_items UUID[],
    uid UUID NOT NULL,
    CONSTRAINT unique_outfit_per_user UNIQUE (title, clothing_items, uid),
    CONSTRAINT fit
      FOREIGN KEY (uid) 
      REFERENCES backend_schema.user(uid)
      ON DELETE CASCADE
);
CREATE TABLE backend_schema.clothing_item (
    ciid UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    image BYTEA NOT NULL,
    category VARCHAR(255) NOT NULL,
    title VARCHAR(50) NOT NULL, 
    uid UUID NOT NULL,
    CONSTRAINT unique_ci_per_user UNIQUE (title, category, uid),
    CONSTRAINT item
      FOREIGN KEY (uid) 
      REFERENCES backend_schema.user(uid)
      ON DELETE CASCADE
);